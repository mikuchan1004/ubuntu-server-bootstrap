#!/bin/bash
# Custom MOTD (Korean) - server status summary

# SSH ì ‘ì† IP ìºì‹œ (sudo/suë¡œ ë“¤ì–´ì˜¬ ë•ŒëŠ” SSH_CLIENTê°€ ë¹„ì–´ ìˆì„ ìˆ˜ ìˆìŒ)
if [ -n "${SSH_CLIENT:-}" ]; then
  export LOGIN_IP="${SSH_CLIENT%% *}"
fi

echo "========================================"
echo " ğŸ–¥  ì„œë²„ ìƒíƒœ ìš”ì•½"
echo "----------------------------------------"
echo " ğŸ“… í˜„ì¬ ì‹œê°„  : $(date '+%Y-%m-%d %H:%M:%S')"
echo " ğŸ‘¤ ë¡œê·¸ì¸ ê³„ì •: $(whoami)"
echo " ğŸŒ ì ‘ì† IP    : ${CLIENT_IP}"
echo " â±  ì—…íƒ€ì„     : $(uptime -p)"
echo " ğŸ’¾ ë””ìŠ¤í¬(/)  : $(df -h / | awk 'NR==2 {print $4}') ì—¬ìœ "
echo " ğŸ§  ë©”ëª¨ë¦¬     : $(free -h | awk '/^Mem:/ {print $7}') ì—¬ìœ "


# Fail2Ban ìƒíƒœ (root ê¶Œí•œ í•„ìš”: ì¼ë°˜ ì‚¬ìš©ìë¡œëŠ” N/Aê°€ ì •ìƒ)
if [ "$(id -u)" -eq 0 ]; then
  BANNED="$(timeout 1 fail2ban-client status sshd 2>/dev/null | awk -F': ' '/Currently banned/ {print $2}')"
  if [ -n "$BANNED" ]; then
    echo " ğŸ” Fail2Ban   : ${BANNED} IP ì°¨ë‹¨ ì¤‘"
  else
    echo " ğŸ” Fail2Ban   : 0 IP ì°¨ë‹¨ ì¤‘"
  fi
else
  echo " ğŸ” Fail2Ban   : (ê¶Œí•œ ì—†ìŒ)"
fi

echo "========================================"
