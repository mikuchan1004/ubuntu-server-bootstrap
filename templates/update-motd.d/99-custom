sudo tee /etc/update-motd.d/99-custom >/dev/null <<'EOF'
#!/usr/bin/env bash
set -euo pipefail

# ì‹¤ì œ ë¡œê·¸ì¸ ì‚¬ìš©ì (sudo/suë¡œ ë°”ë€Œì–´ë„ ì›ë˜ ì‚¬ìš©ì)
LOGIN_USER="$(logname 2>/dev/null || echo unknown)"
RUN_AS="$(whoami)"

# ì›ê²© IP (í™˜ê²½ë³€ìˆ˜ ë§ê³  whoì—ì„œ ì¶”ì¶œ)
CLIENT_IP="$(who -u am i 2>/dev/null | awk '{print $NF}' | tr -d '()')"
[[ -n "$CLIENT_IP" ]] || CLIENT_IP="(ì½˜ì†”/ë¡œì»¬)"

DISK_FREE="$(df -h / | awk 'NR==2 {print $4}')"
MEM_AVAIL="$(awk '/MemAvailable:/ {
  kb=$2; mib=kb/1024; gib=mib/1024;
  if (gib>=1) printf "%.1fGiB",gib;
  else printf "%.0fMiB",mib;
  exit
}' /proc/meminfo)"

echo "========================================"
echo " ğŸ–¥  ì„œë²„ ìƒíƒœ ìš”ì•½"
echo "----------------------------------------"
echo " ğŸ“… í˜„ì¬ ì‹œê°„  : $(date '+%Y-%m-%d %H:%M:%S')"

if [[ "$LOGIN_USER" == "$RUN_AS" ]]; then
  echo " ğŸ‘¤ ë¡œê·¸ì¸ ê³„ì •: ${LOGIN_USER}"
else
  echo " ğŸ‘¤ ë¡œê·¸ì¸ ê³„ì •: ${LOGIN_USER} (í˜„ì¬ ê¶Œí•œ: ${RUN_AS})"
fi

echo " ğŸŒ ì ‘ì† IP    : ${CLIENT_IP}"
echo " â±  ì—…íƒ€ì„     : $(uptime -p)"
echo " ğŸ’¾ ë””ìŠ¤í¬(/)  : ${DISK_FREE} ì—¬ìœ "
echo " ğŸ§  ë©”ëª¨ë¦¬     : ${MEM_AVAIL} ì—¬ìœ "

# Fail2Ban (rootë§Œ)
if [[ "$(id -u)" -eq 0 ]]; then
  BANNED="$(timeout 1 fail2ban-client status sshd 2>/dev/null | awk -F': ' '/Currently banned/ {print $2}')"
  [[ -n "$BANNED" ]] || BANNED="0"
  echo " ğŸ” Fail2Ban   : ${BANNED} IP ì°¨ë‹¨ ì¤‘"
else
  echo " ğŸ” Fail2Ban   : (ê¶Œí•œ ì—†ìŒ)"
fi

echo "========================================"
EOF

sudo chmod 0755 /etc/update-motd.d/99-custom
